# Cloudera Manager的存储空间规划

## 前言

Cloudera Manager（下文简称CM）的存储空间规划必须要拥有的权限为：CM最高级别的管理员权限(Full Administrator)

CM监控许多在后台中的跑服务，作业和应用程序的度量指标。所有这些指标都需要存储。根据数据的大小，存储位置可以是本地或远程，基于磁盘的，也可以是数据库，不同公司或者不同场景都会有一些差别。

以上这些数据一般默认会有一部分写到`/var/log`目录下，如果我们在规划CM存储空间指定到这些目录，我们需要保证这些目录有足够大的空间，因为集群一旦运行起来会收集到很多数据，而且不同公司对于这些日志数据的存储时长还不太一样，因此在规划时需要慎重考量其存储空间，否则可能会为以后挖坑。

如果存储空间规划评估不准(给少了)可能会出现以下问题：

- 群集可能无法保留历史运营数据以满足内部要求。
- 群集可能会错过未在所需时间内收集或保留的关键审核信息。
- 管理员可能无法研究过去的事件或健康状况。
- 管理员在需要稍后引用或报告时，可能没有历史MR1，YARN或Impala使用情况数据。
- 指标收集和图表可能存在差距。
- 由于将存储位置填充到100％的容量，群集可能会遇到数据丢失。这种事件的影响可能会影响许多其他组件。

因此在规划时，我们需要先调研要部署CM的主机的存储情况以及存储设备的划分情况，以便在存储空间划分时能够准确的进行存储规划。

本文我们将讨论本地磁盘存储和RDBMS(数据库)存储。

## Cloudera Manager Server(CMS)

| 配置项                         | 具体操作                                                     |
| ------------------------------ | ------------------------------------------------------------ |
| 默认存储位置                   | DBMS：MySQL5.7+,MariaDB10+,PostgreSQL9.4,oracle12.2<br/>磁盘：CMS默认的本地数据存储目录为`/var/lib/cloudera-scm-server/` |
| 存储配置默认值，最小值或最大值 | CMS数据库的大小取决于托管主机的数量和已在群集中运行的离散命令的数量。要在Cloudera Manager Administration Console中配置保留命令的大小，请选择**管理** > **设置**进行更改。 |
| 在何处控制数据保留或大小       | 没有与此实体相关的直接存储默认值。                           |
| 在何处控制数据保留或大小       | CMS数据库的大小取决于托管主机的数量和已在群集中运行的离散命令的数量。要在Cloudera Manager Administration Console中配置保留命令的大小，请选择**管理** > **设置**进行更改。 |
| 规模调整，规划和最佳实践       | CMS数据库是CM部署中最重要的配置存储。此数据库包含用于定义CM及其托管主机部署的群集，服务，角色和其他必要信息的配置。 |

## Cloudera Management Service

***Cloudera管理服务 - 活动监视器配置***

| 配置项                       | 监控对象                                                     |
| ---------------------------- | ------------------------------------------------------------ |
| 默认存储位置                 | 支持的数据库：MySQL5.7+,MariaDB10+,PostgreSQL9.4,oracle12.2  |
| 存储配置默认值/最小值/最大值 | 默认值：14天的MapReduce（MRv1）作业/任务                     |
| 在何处控制数据保留或大小     | 可以通过配置要保留的数据的天数或小时数来控制活动监视器的存储使用情况。清除旧数据。<br/>1.要在Cloudera Manager Administration Console中配置数据保留：
2.去Cloudera管理服务。
3.单击“ 配置”选项卡。
4.选择Scope > Activity Monitor或Cloudera Management Service（服务范围）。
5.选择Category > Main。
6.找到以下属性或通过在“ 搜索”框中键入属性名称来搜索它们：
7.输入更改原因，然后单击“ 保存更改”以提交更改。 |
| 规模调整，规划和最佳实践     | 活动监视器仅监视MapReduce作业，而不监视YARN应用程序。如果您不再在群集中使用MapReduce（MRv1），则Cloudera Manager或CDH不需要活动监视器。<br/>14天MapReduce活动所需的存储空间量可能差异很大，直接取决于群集的大小和使用MapReduce的活动级别。在确定群集中MapReduce活动的“稳定状态”和“突发状态”时，可能需要调整和重新调整存储量。
例如，请考虑以下测试群集和用法：
1.模拟的1000个主机群集，每个主机具有32个插槽
2.每个活动（作业）200次尝试（任务）的MapReduce作业
3.调整此群集的观察大小：
4.每次尝试都需要10分钟才能完成。
5.这种使用每天导致约2万个工作，总尝试次数约为500万。
6.对于7天的保留期，此活动监视器数据库需要200 GB。 |


